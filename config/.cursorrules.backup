# Cursor AI Rules - AI Power Pack v2.4

## CRITICAL RULES (MUST FOLLOW)

### Global Quality Requirements
1. CODE MUST BE ORGANIZED AND CLEAR
2. SINGLE FILE < 200 LINES
3. QUALITY > QUANTITY
4. MUST FULFILL REQUIREMENTS
5. PRODUCTION-READY ON FIRST TRY

## Core Principles (From Fabric + Cursor Rules)
- Write production-ready code on first try
- Follow project conventions in CLAUDE.md
- Prefer composition over inheritance
- Keep functions pure when possible

## PLAN-EXECUTE Pattern (MANDATORY)
```
// PLAN:
// 1. [Step 1]
// 2. [Step 2]
// 3. [Step 3]

// EXECUTE:
function implement() { ... }
```

## File Size Limits
| File Type | Max Lines |
|-----------|-----------|
| Component | 200 |
| Hook | 100 |
| Service | 150 |
| Utility | 100 |

## Security Rules (From OpenSkills)
- Validate all user inputs
- Use parameterized queries
- Never log sensitive data
- Handle errors gracefully

## UI/UX Standards (From UI/UX Pro Max)
- Consistent design language
- Mobile-first responsive
- Clear user feedback
- Accessible (WCAG 2.1)

## Git Version Control Rules / Git版本控制规则

### Commit Messages / 提交信息
```
MUST follow format:
type(scope): subject

Examples:
feat(auth): implement JWT authentication
fix(api): handle null user response
docs(readme): add setup instructions
refactor(utils): simplify date formatting
```

### Before Every Commit / 每次提交前
- [ ] Run tests / 运行测试
- [ ] Check linting / 检查代码规范
- [ ] Review changes / 检查更改
- [ ] Update docs if needed / 必要时更新文档

### Branch Rules / 分支规则
- Feature branches from `develop`
- Hotfix branches from `main`
- Delete branch after merge
- Keep branches short-lived (< 3 days)

## Context Management Rules / 上下文管理规则

### When Context > 100K Tokens
1. Summarize completed tasks
2. Extract key decisions to bullet points
3. Keep only recent 10-20 messages
4. Reference files instead of full content

### Claude/Gemini Optimization
- Use Prompt Caching for static rules
- Compress historical conversations
- Start fresh chat when >150K tokens
- Keep project structure always visible

## Code Self-Execution / 代码自运行

### MUST Include in Every File
```python
if __name__ == "__main__":
    # Test 1: Basic
    print("Test 1:", function("input"))
    
    # Test 2: Edge case
    print("Test 2:", function(""))
    
    # Test 3: Performance
    import time
    start = time.time()
    function("benchmark")
    print(f"Time: {time.time()-start:.4f}s")
```

### Auto-Test Requirements
- [ ] 3+ test cases per function
- [ ] Clear output showing results
- [ ] Performance measurement for key functions
- [ ] Can run with single command

## Additional Standards / 补充标准

### API Keys
```python
# ✓ Use environment variables
import os
KEY = os.getenv('API_KEY')

# ✗ Never hardcode
KEY = "sk-123456"  # FORBIDDEN!
```

### Logging
```python
import logging
logger = logging.getLogger(__name__)
logger.info("Message")  # Not print()
```

### Dependencies
- Python: Include requirements.txt
- Node.js: Include package.json
- Lock all versions

### Documentation
- Docstrings for all functions
- Type hints (Python 3.10+)
- Example usage in docstring

## Never Commit / 绝不提交
- Secrets, API keys, passwords
- node_modules, venv, __pycache__
- Build artifacts (dist/, build/)
- IDE config (.vscode/, .idea/)
- Personal configs (.env.local)

## Error Prevention / 错误预防

### Common Mistakes / 常见错误
```yaml
❌ File > 200 lines → ✓ Split into modules
❌ No tests → ✓ Add if __name__ == "__main__"
❌ Hardcoded secrets → ✓ Use os.getenv()
❌ print() everywhere → ✓ Use logging
❌ Vague commits → ✓ type(scope): subject
```

### User Feedback Log / 反馈日志
Track user-reported issues:
- [Date]: [Error] → [Fix]
- Add new entries when mistakes occur
- Review before starting new tasks

### Learning Protocol / 学习协议
1. User points out error → Fix + Document
2. Add to common mistakes list
3. Update rules to prevent recurrence
4. Apply to all future similar tasks
